# 本番環境PWAデモガイド

**デモサイト**: https://pwa-sample-project-82c16.web.app

> 📱 **推奨**: このデモはスマートフォンでアクセスして、実際のPWA体験を確認することを強く推奨します。

## 🎯 デモの目的

このPWAデモサイトは、本プロジェクトで実装したPWA技術の実動作確認用環境です。Service Worker、Background Sync、リアルタイム通信制限など、各種PWA機能を実際に体験・テストできます。

## 🔧 利用可能な機能・テスト

### **1. 基本PWA機能**

#### **オンライン/オフライン状態監視**
- **機能**: リアルタイムでネットワーク状態を表示
- **テスト方法**: 
  1. ページにアクセス
  2. ネットワーク設定でWiFi/モバイルデータをON/OFF
  3. 状態表示の変化を確認

#### **Service Worker登録確認**
- **機能**: Service Workerの登録状況を表示
- **確認方法**: ページ上部の「状態」セクションで「SW登録」ステータスを確認

#### **オフライン動作テスト**
- **機能**: ネットワーク切断時でも基本機能が動作
- **テスト手順**:
  1. 一度ページを表示（キャッシュ作成）
  2. ネットワークを切断
  3. ページをリロード → `/offline.html`へのフォールバック確認

### **2. Background Sync機能**

#### **オフライン時データ送信予約**
- **機能**: オフライン時にデータ送信を予約し、オンライン復帰時に自動送信
- **テスト手順**:
  1. 「バックグラウンド通信テスト」セクションに移動
  2. ネットワークを切断（オフライン状態）
  3. メッセージを入力して「Background Syncで送信」をクリック
  4. 複数のメッセージを送信（キューイング確認）
  5. ネットワークを復旧
  6. 自動的にキューされたメッセージが順次送信される様子を確認

#### **手動同期実行**
- **機能**: Background Syncを手動でトリガー
- **使用方法**: 「強制同期実行」ボタンで未送信メッセージを即座に送信

#### **未送信メッセージ確認**
- **機能**: IndexedDBに保存された未送信データの確認
- **確認方法**: 「未送信メッセージ確認」ボタンで現在のキュー状況を表示

### **3. リアルタイム通信制限テスト**

#### **バックグラウンド通信制限の実証**
- **機能**: Page Visibility APIを使った通信制限の検証
- **テスト項目**:
  - **visible時**: 正常間隔（設定通り）
  - **hidden時**: 段階的延長（1秒 → 2-4秒）
  - **復帰時**: 即座に正常間隔に戻る

#### **通信間隔テスト**
- **利用可能間隔**: 1秒、5秒、10秒、30秒、1分
- **テスト手順**:
  1. 「リアルタイム通信制限テスト」の間隔を選択
  2. 「通信開始」をクリック
  3. タブを別のタブに切り替え（hidden状態）
  4. 通信ログで実際の間隔変化を観測
  5. タブに戻って即座回復を確認

### **4. Push通知テスト**

#### **通知購読**
- **機能**: VAPID鍵を使ったプッシュ通知購読
- **テスト手順**:
  1. 「Push通知テスト」セクションで「通知を許可」をクリック
  2. ブラウザの通知許可ダイアログを承認
  3. 購読情報（JSON）が表示される

#### **購読情報確認**
- **機能**: 現在の購読状況とエンドポイント情報を表示
- **活用**: 実際のプッシュサーバー実装時の参考データ

### **5. キャッシュ管理・デバッグ**

#### **キャッシュ確認**
- **機能**: 現在のCache Storageの内容を表示
- **確認項目**: キャッシュキー一覧、保存サイズ

#### **キャッシュ削除**
- **機能**: 全キャッシュの強制削除
- **使用場面**: 
  - 更新されたファイルが反映されない時
  - 開発中のテスト環境クリア
  - ストレージ容量確認

#### **強制更新（デバッグ用）**
- **機能**: Service Workerを強制的に新バージョンに更新
- **使用方法**: 赤い「強制更新」ボタンで即座にSW更新

### **6. 詳細ログ・統計情報**

#### **リアルタイム通信統計**
- **表示内容**:
  - 総送信回数
  - 経過時間
  - 平均通信間隔
  - 実際の間隔（ms単位）
  - visibility状態（visible/hidden）

#### **Background Sync成功ログ**
- **表示形式**: `✅ 時刻: "メッセージ内容" 送信成功`
- **活用**: 送信タイミングと成功状況の確認

## 📱 推奨テストシナリオ

### **初回体験者向け（10分）**
1. **スマホでアクセス** → ホーム画面に追加
2. **オフライン時動作確認** → ネットワーク切断してリロード
3. **Background Sync基本テスト** → オフライン時にメッセージ送信
4. **PWAらしさ体感** → URLバー非表示でのアプリ体験

### **開発者向け詳細テスト（30分）**
1. **全機能一巡** → 各テスト機能を順次実行
2. **DevTools連携** → Application タブでSW状況確認
3. **パフォーマンス測定** → Network タブで通信状況観測
4. **多端末テスト** → iOS/Android/PCでの挙動差確認

### **技術検証者向け（60分）**
1. **限界テスト** → 大量メッセージでキューイング限界確認
2. **ネットワーク障害シミュレーション** → 断続的接続での挙動
3. **長時間バックグラウンドテスト** → 30秒以上のhidden状態
4. **ブラウザ差検証** → Chrome/Safari/Firefoxでの対応差確認

## 🔍 トラブルシューティング

### **よくある問題**
- **Background Syncが動作しない** → Chrome以外のブラウザでは制限あり
- **通知が表示されない** → ブラウザの通知設定を確認
- **オフライン動作しない** → HTTPSでアクセスしているか確認
- **古いキャッシュが残る** → 「キャッシュを全削除」を実行

### **対応ブラウザ**
- **Chrome**: 全機能完全対応
- **Safari iOS**: Background Sync以外は対応
- **Firefox**: 基本機能のみ対応
- **Safari Mac**: 16.4+でPush通知対応

## 🎯 学習効果

このデモサイトを通じて以下の実体験が得られます：

1. **PWAの実用性** → ネイティブアプリに近い体験
2. **Service Workerの威力** → 確実なオフライン対応
3. **Background Syncの価値** → データ送信の信頼性
4. **ブラウザ制限の現実** → プラットフォーム差の理解
5. **実装の複雑性** → 各種エッジケースへの対応

---

**更新日**: 2025-09-07  
**対応PWA**: https://pwa-sample-project-82c16.web.app  
**推奨端末**: スマートフォン（iOS Safari / Android Chrome）